# CRISPR benchmarking related analyses
This snakemake workflow performs CRISPR benchmarking and other related analyses presented in the
ENCODE-rE2G ENCODE companion paper. Most analyses depend on running the CRISPR benchmarking pipeline 
(see below).

The workflow performs analyses shown in the following figures, tables and supplementary notes:
- Fig 1b
- Fig 2b-d
- Fig 4e
- Fig 5a, d, f, g
- Extended Data Fig 1
- Extended Data Fig 2
- Extended Data Fig 3
- Extended Data Fig 6i
- Extended Data Fig 7
- Fig Note S1.1b-f
- Fig Note S1.2b
- Fig S7
- Fig S8
- Fig S9
- Fig S10
- Fig S11
- Table S2
- Table S9
- Table S10
- Table S15
- Table S16
- Table S17

## Running the CRISPR benchmarking pipeline
The `CRISPR_comparison` subdirectory contains a copy of the
[CRISPR benchmarking pipeline](https://github.com/EngreitzLab/CRISPR_comparison). Config
files for performing benchmarks used in CRISPR analyses are found in `CRISPR_comparison_resources`.

The `CRISPR_comparison_resources/crispr_benchmarks_manuscript.yml` lists input files and parameters
for all manuscript benchmarks. To run any of these, specified prediction files have to be downloaded
from the ENCODE portal, downloaded from synapse or be generated by one of the other provided
workflows (e.g., enhancer activity ABC, baseline predictors, E-G correlation predictors).
`CRISPR_comparison_resources/crispr_benchmarks_manuscript.yml` can be modified with updated local
paths to downloaded files.

To run the workflow with adapted input file paths, activate snakemake and run the following command:
```sh
# go into the CRISPR benchmarking subdirectory
cd CRISPR_comparison

# execute full workflow to generate all output files (-n = dryrun, remove to execute workflow)
snakemake --use-conda --profile <cluster_profile> --configfile ../CRISPR_comparison_resources/crispr_benchmarks_manuscript.yml -j28 -n
```

For reproducing specific analyses, the CRISPR benchmarking pipeline can be run for individual
comparisons by requesting the main output file. These follow the pattern:
`"results/<comparison/<comparison>_crispr_comparison.html`

For example:
```sh
# execute full workflow to generate all output files (-n = dryrun, remove to execute workflow)
snakemake --use-conda --profile <cluster_profile> --configfile ../CRISPR_comparison_resources/crispr_benchmarks_manuscript.yml results/MainPredictors/MainPredictors_crispr_comparison.html -j2 -n
```

## Running the CRISPR analyses workflow
After running the CRISPR benchmarking pipeline, the CRISPR analysis workflow can be run to reproduce
manuscript analyses:
```sh
# execute full workflow to generate all analysis results (-n = dryrun, remove to execute workflow)
snakemake --use-conda --profile <cluster_profile> -j30 -n
```
